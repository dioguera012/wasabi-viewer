<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wasabi Viewer</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body>
    <!-- Tela de Configura√ß√£o -->
    <div id="config-screen" class="screen active">
        <div class="config-container">
            <!-- Bot√£o de Configura√ß√µes na tela inicial -->
            <button id="settings-btn-config" class="btn btn-secondary btn-icon" title="Configura√ß√µes" style="position:absolute; top:16px; right:16px;">
                <i class="fas fa-cog"></i>
            </button>
            <div class="config-header">
                <h1>
                    <span class="brand-logo" aria-hidden="true">
                        <img src="../../assets/green_leaf_logo.png" alt="Wasabi Logo" class="brand-logo-img">
                    </span>
                    Wasabi Viewer
                </h1>
                <p>Gerencie conex√µes com seus buckets Wasabi S3</p>
                <!-- Mensagem tem√°tica de Natal -->
                <div class="xmas-banner" role="note" aria-label="Feliz Natal">
                    <i class="fas fa-tree"></i>
                    <span class="title">Feliz Natal</span>
                    <span class="subtitle">Boas festas e bons downloads!</span>
                </div>
            </div>

            <!-- Menu de A√ß√µes -->
            <div class="menu-actions">
                <button id="new-config-btn" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Nova Configura√ß√£o
                </button>
            </div>

            <!-- Lista de Buckets Salvos -->
            <div id="saved-configs" class="saved-configs">
                <h3>Buckets Salvos</h3>
                <div id="config-list" class="config-list">
                    <div class="empty-configs">
                        <i class="fas fa-plus-circle"></i>
                        <p>Adicione sua primeira configura√ß√£o abaixo</p>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o de Token Compartilhado -->
            <div class="share-section card">
                <h3>Conectar via Token Compartilhado</h3>
                <div class="share-token-input">
                    <input type="text" id="share-token-input" placeholder="Cole o token compartilhado aqui...">
                    <button type="button" id="connect-shared-btn" class="btn btn-primary">
                        <i class="fas fa-key"></i> Conectar
                    </button>
                </div>
            </div>

            <div id="config-status" class="status-message"></div>
        </div>
    </div>

    <!-- Modal de Nova/Editar Configura√ß√£o -->
    <div id="config-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="config-modal-title">Nova Configura√ß√£o</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="config-form" class="config-form">
                    <div class="form-group">
                        <label for="accessKey">Access Key:</label>
                        <input type="text" id="accessKey" required>
                    </div>

                    <div class="form-group">
                        <label for="secretKey">Secret Key:</label>
                        <input type="password" id="secretKey" required>
                    </div>

                    <div class="form-group">
                        <label for="configName">Nome da Configura√ß√£o:</label>
                        <input type="text" id="configName" placeholder="ex: Bucket Principal" required>
                    </div>

                    <div class="form-group">
                        <label for="bucket">Bucket:</label>
                        <input type="text" id="bucket" required>
                    </div>

                    <div class="form-group">
                        <label for="prefix">Prefix (opcional):</label>
                        <input type="text" id="prefix" placeholder="ex: uploads/">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="region">Regi√£o:</label>
                            <select id="region" required>
                                <option value="us-east-1">us-east-1</option>
                                <option value="us-west-1">us-west-1</option>
                                <option value="eu-central-1">eu-central-1</option>
                                <option value="ap-northeast-1">ap-northeast-1</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="endpoint">Endpoint:</label>
                            <input type="url" id="endpoint" value="https://s3.wasabisys.com" required>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> <span id="save-btn-text">Salvar e Conectar</span>
                        </button>
                        <button type="button" id="cancel-modal-btn" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Tela Principal -->
    <div id="main-screen" class="screen">
        <header class="main-header">
            <div class="header-left">
                <h1>
                    <span class="brand-logo" aria-hidden="true">
                        <img src="../../assets/green_leaf_logo.png" alt="Wasabi Logo" class="brand-logo-img">
                    </span>
                    Wasabi Viewer
                </h1>
                <div class="bucket-selector">
                    <select id="bucket-select" class="bucket-select">
                        <option value="">Selecione um bucket...</option>
                    </select>
                </div>
                <button id="config-btn" class="btn btn-secondary" title="In√≠cio">
                    <i class="fas fa-home"></i> In√≠cio
                </button>
            </div>

            <div class="header-right">
                <div class="search-container">
                    <input type="text" id="search-input" placeholder="Pesquisar arquivos...">
                    <i class="fas fa-search"></i>
                </div>

                <button id="settings-btn" class="btn btn-secondary btn-icon" title="Configura√ß√µes">
                    <i class="fas fa-cog"></i>
                </button>

                <button id="refresh-btn" class="btn btn-primary">
                    <i class="fas fa-sync-alt"></i> Atualizar
                </button>
            </div>
        </header>

        

        <main class="main-content">
            <!-- Navega√ß√£o de pastas -->
            <div class="breadcrumb">
                <div class="nav-arrows" aria-label="Navega√ß√£o">
                    <button id="nav-back" class="nav-arrow-btn" title="Voltar" aria-label="Voltar">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <button id="nav-forward" class="nav-arrow-btn" title="Avan√ßar" aria-label="Avan√ßar">
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                <span id="breadcrumb-path">
                    <i class="fas fa-home"></i> In√≠cio
                </span>
            </div>

            <!-- Lista de arquivos -->
            <div class="file-list-container">
                <div class="file-list-header">
                    <div class="column-header name-column sortable" data-sort="name">
                        <i class="fas fa-file"></i> Nome <i class="fas fa-sort sort-icon"></i>
                    </div>
                    <div class="column-header size-column sortable" data-sort="size">
                        <i class="fas fa-weight-hanging"></i> Tamanho <i class="fas fa-sort sort-icon"></i>
                    </div>
                    <div class="column-header date-column sortable" data-sort="date">
                        <i class="fas fa-calendar"></i> Modificado <i class="fas fa-sort sort-icon"></i>
                    </div>
                    <div class="column-header actions-column">
                        <i class="fas fa-tools"></i> A√ß√µes
                    </div>
                </div>

                <div id="file-list" class="file-list">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        Carregando arquivos...
                    </div>
                </div>
            </div>
        </main>

        <!-- Modal de Progress -->
        <div id="progress-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Download em andamento...</h3>
                    <div class="modal-actions"></div>
                </div>
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill"></div>
                    <span id="progress-percent" class="progress-label">0%</span>
                </div>
                <div class="progress-filename">
                    <i class="fas fa-file"></i>
                    <span id="progress-file-name"></span>
                </div>
                <p id="progress-text">Preparando download...</p>
                <div class="progress-meta" style="margin-top:6px; gap:10px;">
                    <span id="progress-size">0 B / 0 B</span>
                    <span id="progress-eta">‚Äî</span>
                </div>
                <div class="progress-actions">
                    <button id="minimize-download-btn" class="btn btn-secondary btn-compact">Minimizar</button>
                    <button id="cancel-download-btn" class="btn btn-danger btn-compact">Cancelar Download</button>
                </div>

                <!-- Fila no canto inferior esquerdo com fold clic√°vel -->
                <div class="modal-queue-wrap">
                    <span id="modal-queue-count" class="modal-queue"></span>
                    <span id="queue-popover-toggle" class="queue-arrow" aria-label="Ver fila" aria-expanded="false">
                        <i class="fas fa-chevron-down"></i>
                    </span>
                    <div id="queue-popover" class="queue-popover" role="tooltip" aria-hidden="true"></div>
                </div>
            </div>
        </div>

        <!-- Modal de Salvar Arquivo foi movido para fora de main-screen -->
        <!-- Modal de Confirma√ß√£o de Cancelamento -->
        <div id="cancel-confirm-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Cancelar Download</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="confirm-actions" style="margin-top:16px; display:flex; gap:10px; justify-content:center; flex-wrap: wrap;">
                        <button id="cancel-confirm-yes" class="btn btn-danger">Cancelar somente atual</button>
                        <button id="cancel-confirm-all" class="btn btn-warning">Cancelar toda a fila</button>
                        <button id="cancel-confirm-no" class="btn btn-secondary">Manter</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Remo√ß√£o de item da fila -->
        <div id="queue-remove-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Remover da fila</h3>
                </div>
                <div class="modal-body">
                    <p style="text-align:center;">Remover arquivo da fila da download?</p>
                    <div class="form-actions" style="justify-content:center; margin-top:14px;">
                        <button id="queue-remove-yes" class="btn btn-danger">Remover</button>
                        <button id="queue-remove-no" class="btn btn-secondary">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Compartilhamento -->
        <div id="share-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Compartilhar Configura√ß√£o</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="share-info">
                        <p><strong>Configura√ß√£o:</strong> <span id="share-config-name"></span></p>
                        <p class="share-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            Este token cont√©m credenciais de acesso. Compartilhe apenas com pessoas confi√°veis.
                        </p>
                    </div>

                    <div class="share-actions">
                        <button id="generate-token-btn" class="btn btn-primary">
                            <i class="fas fa-share"></i> Gerar Token de Compartilhamento
                        </button>
                    </div>

                    <div id="share-result" class="share-result">
                        <label>Token de Compartilhamento:</label>
                        <textarea id="share-token" readonly></textarea>
                        <div class="share-result-actions">
                            <button id="copy-token-btn" class="btn btn-success">
                                <i class="fas fa-copy"></i> Copiar Token
                            </button>
                            <button id="copy-instructions-btn" class="btn btn-info">
                                <i class="fas fa-info-circle"></i> Copiar Instru√ß√µes
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Erro de Caminho foi movido para fora de main-screen -->

        <!-- Modal de Link -->
        <div id="link-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Link do Arquivo</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="link-options">
                        <button id="link-15m-btn" class="btn btn-primary btn-compact" title="Gerar link v√°lido por 15 minutos">
                            <i class="far fa-clock"></i> 15min
                        </button>
                        <button id="link-1h-btn" class="btn btn-primary btn-compact" title="Gerar link v√°lido por 1 hora">
                            <i class="far fa-clock"></i> 1h
                        </button>
                        <button id="link-24h-btn" class="btn btn-primary btn-compact" title="Gerar link v√°lido por 24 horas">
                            <i class="far fa-clock"></i> 24h
                        </button>
                        <button id="link-custom-btn" class="btn btn-secondary btn-compact" title="Gerar link com validade personalizada">
                            <i class="fas fa-sliders-h"></i> Personalizado
                        </button>
                    </div>
                    <div id="link-custom" class="link-custom" aria-hidden="true">
                        <label for="custom-expiry-value" class="sr-only">V√°lido por</label>
                        <div class="number-stepper" role="group" aria-label="Definir tempo de validade">
                            <button id="custom-expiry-dec" class="btn btn-secondary btn-compact" aria-label="Diminuir">
                                <i class="fas fa-minus"></i>
                            </button>
                            <input id="custom-expiry-value" type="number" min="1" max="10080" value="1" inputmode="numeric" />
                            <button id="custom-expiry-inc" class="btn btn-secondary btn-compact" aria-label="Aumentar">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <select id="custom-expiry-unit" class="select-compact">
                            <option value="minutes">minutos</option>
                            <option value="hours" selected>horas</option>
                            <option value="days">dias</option>
                        </select>
                        <button id="link-custom-generate-btn" class="btn btn-primary btn-compact">
                            <i class="fas fa-key"></i> Gerar Link
                        </button>
                        <span class="hint">Limite: at√© 7 dias</span>
                    </div>
                    <div class="link-result">
                        <textarea id="generated-link" readonly></textarea>
                        <button id="copy-link-btn" class="btn btn-success">
                            <i class="fas fa-copy"></i> Copiar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications -->
    <div id="notifications" class="notifications"></div>

    <!-- Modal de Salvar Arquivo (fora de main-screen para tamb√©m funcionar na tela inicial) -->
    <div id="save-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Salvar arquivo</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="save-nav-row" style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
                    <button id="save-nav-back" class="btn btn-secondary btn-compact" title="Voltar">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <button id="save-nav-forward" class="btn btn-secondary btn-compact" title="Avan√ßar">
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                <div class="breadcrumb" id="save-breadcrumb" contenteditable="true" spellcheck="false" title="Digite um caminho completo e pressione Enter"></div>
                <div id="save-dir-list" class="file-list" style="height: 260px; overflow-y:auto; border:1px solid var(--border-light); border-radius:8px;">
                    <!-- diret√≥rios ser√£o listados aqui -->
                </div>
                <div class="form-row" id="save-input-row" style="margin-top:12px;">
                    <label id="save-input-label" for="save-file-name">Nome do arquivo</label>
                    <input id="save-file-name" type="text" placeholder="nome.ext" />
                </div>
                <div class="form-actions" style="justify-content:center; margin-top:14px;">
                    <button id="save-confirm-btn" class="btn btn-primary">Salvar aqui</button>
                    <button id="save-cancel-btn" class="btn btn-secondary">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Decora√ß√£o Natalina: luzes piscantes no topo (n√£o interfere em cliques) -->
    <div id="christmas-lights" class="christmas-lights" aria-hidden="true">
        <div class="lights">
            <span class="bulb"></span>
            <span class="bulb"></span>
            <span class="bulb"></span>
            <span class="bulb"></span>
            <span class="bulb"></span>
            <span class="bulb"></span>
            <span class="bulb"></span>
            <span class="bulb"></span>
            <span class="bulb"></span>
            <span class="bulb"></span>
            <span class="bulb"></span>
            <span class="bulb"></span>
            <span class="bulb"></span>
            <span class="bulb"></span>
            <span class="bulb"></span>
            <span class="bulb"></span>
            <span class="bulb"></span>
            <span class="bulb"></span>
            <span class="bulb"></span>
            <span class="bulb"></span>
            <span class="bulb"></span>
            <span class="bulb"></span>
            <span class="bulb"></span>
            <span class="bulb"></span>
        </div>
    </div>

    <!-- Tren√≥ voando (primeira abertura) -->
    <div id="santa-sleigh" class="santa-sleigh" aria-hidden="true">
        <span class="santa">üéÖ</span>
        <span class="sled">üõ∑</span>
    </div>

    <!-- Camada de part√≠culas de neve (overlay) -->
    <div id="snow-layer" aria-hidden="true"></div>

    <!-- Modal de Erro de Caminho (fora de main-screen) -->
    <div id="path-error-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Local n√£o encontrado</h3>
            </div>
            <div class="modal-body">
                <p style="text-align:center;">N√£o foi poss√≠vel encontrar o local indicado.</p>
                <div class="form-actions" style="justify-content:center; margin-top:14px;">
                    <button id="path-error-ok" class="btn btn-primary">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Configura√ß√µes (fora de main-screen para funcionar tamb√©m na tela inicial) -->
    <div id="settings-modal" class="modal">
        <div class="modal-content settings-content">
            <div class="modal-header">
                <h3>Configura√ß√µes</h3>
                <button id="settings-close" class="modal-close" aria-label="Fechar">&times;</button>
            </div>
            <div class="settings-layout">
                <aside class="settings-sidebar">
                    <ul>
                        <li class="settings-tab active" data-tab="preferences">Prefer√™ncias</li>
                        <li class="settings-tab" data-tab="theme">Tema</li>
                    </ul>
                </aside>
                <section class="settings-body">
                    <div id="settings-section-preferences" class="settings-section active">
                        <h4>Prefer√™ncias</h4>
                        <div class="setting-item">
                            <label class="setting-label">
                                <input type="checkbox" id="pref-use-default-download">
                                Definir local de download
                            </label>
                            <div class="setting-sub">
                                <div class="setting-path" id="pref-default-download-path">Nenhum diret√≥rio definido</div>
                                <button id="pref-choose-download-dir" class="btn btn-secondary btn-small">Selecionar pasta</button>
                            </div>
                        </div>
                    </div>

                    <div id="settings-section-theme" class="settings-section">
                        <h4>Tema</h4>
                        <div class="setting-item">
                            <span class="setting-label">Tema escuro</span>
                            <label class="switch">
                                <input type="checkbox" id="theme-switch">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Mini janela de download (canto inferior direito) -->
    <div id="download-mini" class="download-mini">
        <div class="mini-header">
            <div class="mini-left">
                <span class="mini-title">Download em andamento</span>
            </div>
            <div class="mini-actions">
                <span id="mini-queue-count" class="mini-queue" aria-live="polite"></span>
                <button id="mini-restore-btn" class="btn btn-secondary btn-tiny">Restaurar</button>
                <button id="mini-cancel-btn" class="btn btn-danger btn-tiny">Cancelar</button>
            </div>
        </div>
        <div class="mini-body">
            <div class="progress-bar progress-mini">
                <div id="mini-progress-fill" class="progress-fill"></div>
                <span id="mini-progress-percent" class="progress-label">0%</span>
            </div>
            <div class="progress-meta mini-meta">
                <span id="mini-progress-size">0 B / 0 B</span>
                <span id="mini-progress-eta">‚Äî</span>
            </div>
        </div>
    </div>

    <script src="renderer.js"></script>
</body>

</html>